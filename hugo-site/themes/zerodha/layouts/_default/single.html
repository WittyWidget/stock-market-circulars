{{ define "title" }}{{ .Title }} - {{ .Site.Title }}{{ end }}

{{ define "description" }}{{ .Params.description | default .Summary }}{{ end }}

{{ define "main" }}
<article class="article-container">
    <!-- Breadcrumb -->
    <div class="breadcrumbs">
        <ul>
            <li><a href="{{ "/" | relURL }}">Home</a></li>
            <li><a href="{{ "circulars" | relURL }}">Circulars</a></li>
            {{ if .Params.source }}
            <li><a href="{{ printf "circulars/%s" .Params.source | relURL }}">{{ upper .Params.source }}</a></li>
            {{ end }}
            <li>{{ .Title }}</li>
        </ul>
    </div>

    <!-- Article Header -->
    <header class="article-header">
        <div class="article-header-meta">
            <div class="article-badges">
                {{ if .Params.source }}
                <div class="source-badge source-{{ .Params.source }}">
                    {{ upper .Params.source }}
                </div>
                {{ end }}
                
                {{ if .Params.severity }}
                <div class="severity-badge severity-{{ .Params.severity }}">
                    {{ if eq .Params.severity "high" }}üî¥{{ else if eq .Params.severity "medium" }}üü°{{ else }}üü¢{{ end }}
                    {{ title .Params.severity }} Severity
                </div>
                {{ end }}
            </div>
            
            <div class="article-meta-info">
                <div class="article-date">{{ .Date.Format "January 2, 2006" }}</div>
                {{ if .Params.circular_id }}
                <div class="article-id">{{ .Params.circular_id }}</div>
                {{ end }}
            </div>
        </div>
        
        <h1 class="article-title">{{ .Title }}</h1>
        
        {{ if .Params.description }}
        <p class="article-description">{{ .Params.description }}</p>
        {{ end }}
    </header>

    <!-- Key Information Cards -->
    <div class="info-cards-grid">
        <!-- Impact Card -->
        {{ if .Params.impact }}
        <div class="info-card">
            <div class="info-card-content">
                <h3 class="info-card-title">Impact Level</h3>
                <div class="info-card-value impact-{{ .Params.impact }}">
                    {{ title .Params.impact }}
                </div>
                {{ if .Params.impact_ranking }}
                <p class="info-card-detail">Ranking: {{ title .Params.impact_ranking }}</p>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <!-- Importance Card -->
        {{ if .Params.importance_ranking }}
        <div class="info-card">
            <div class="info-card-content">
                <h3 class="info-card-title">Importance</h3>
                <div class="info-card-value importance-{{ .Params.importance_ranking }}">
                    {{ title .Params.importance_ranking }}
                </div>
                {{ if .Params.justification }}
                <p class="info-card-detail">{{ .Params.justification }}</p>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <!-- Category Card -->
        {{ if .Params.category }}
        <div class="info-card">
            <div class="info-card-content">
                <h3 class="info-card-title">Category</h3>
                <div class="info-card-value">{{ title .Params.category }}</div>
                <a href="{{ printf "categories/%s" .Params.category | relURL }}" class="info-card-button">
                    View Similar
                </a>
            </div>
        </div>
        {{ end }}
    </div>


    <!-- Content -->
    <div class="article-content-section">
        <div class="article-content-header">
            <h2 class="article-content-title">Circular Summary</h2>
        </div>
        <div class="article-prose">
            {{ .Content }}
        </div>
    </div>

    <!-- Tags and Metadata -->
    <div class="metadata-cards-grid">
        <!-- Tags -->
        {{ if .Params.tags }}
        <div class="metadata-card">
            <div class="metadata-card-content">
                <h3 class="metadata-card-title">Tags</h3>
                <div class="metadata-tags-list">
                    {{ range .Params.tags }}
                    <a href="{{ printf "tags/%s" (. | urlize) | relURL }}" class="stock-tag">
                        {{ . | lower }}
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}

        <!-- Stock Mentions -->
        {{ if .Params.stocks }}
        <div class="metadata-card">
            <div class="metadata-card-content">
                <h3 class="metadata-card-title">Mentioned Stocks</h3>
                <div class="metadata-tags-list">
                    {{ range .Params.stocks }}
                    <a href="{{ printf "stocks/%s" (. | urlize) | relURL }}" class="stock-tag">
                        {{ . }}
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Related Circulars -->
    {{ $related := .Site.RegularPages.Related . | first 3 }}
    {{ if $related }}
    <div class="related-circulars-section">
        <h2 class="related-circulars-title">Related Circulars</h2>
        <div class="related-circulars-grid">
            {{ range $related }}
            {{ partial "circular-card.html" . }}
            {{ end }}
        </div>
    </div>
    {{ end }}

    <!-- Navigation -->
    <div class="article-navigation">
        <a href="{{ "circulars" | relURL }}" class="nav-button nav-button-secondary">
            ‚Üê Back to All Circulars
        </a>
        
        <div class="article-nav-actions">
            {{ if .Params.source }}
            <a href="{{ printf "circulars/%s" .Params.source | relURL }}" class="nav-button nav-button-primary">
                More from {{ upper .Params.source }}
            </a>
            {{ end }}
        </div>
    </div>
</article>
{{ end }}